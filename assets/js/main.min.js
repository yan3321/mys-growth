const ctx_line=document.getElementById("lineChart").getContext("2d");function createGradient(t,e){let n=t.createLinearGradient(0,0,e,0);return n.addColorStop(0,"#109341"),n.addColorStop(1,"#00B342"),n}const lineChartData={labels:[],datasets:[{label:"Member count",backgroundColor:"rgba(0, 100, 200, .7)",borderWidth:2,data:[]}]},lineChart=new Chart(ctx_line,{type:"line",data:lineChartData,options:{scales:{xAxes:[{type:"time",distribution:"linear",time:{unit:"month",tooltipFormat:"DD MMM YYYY"},ticks:{source:"auto"},gridLines:{zeroLineColor:"rgba(0, 0, 0, 0.1)"}}],yAxes:[{type:"linear"}]},maintainAspectRatio:!1,onResize:(t,e)=>{}}});lineChart.canvas.parentNode.style.height="64vh";let autoUpdate=!1,currentMode="full",cachedData=!1;function updateView(t=currentMode,e=cachedData){let n=[];const a=[];let o=!1;e.forEach((e,r)=>{const l=e[0],i=e[1],d=new Date(l),u=(d.toDateString(),d.getMonth()),c=d.getFullYear();if((0!=o&&!o||o!=u)&&(o=u,n.push({date:d,year:c,month:u,members:i})),"full"==t){const t={t:d,y:i};a.push(t),lineChartData.datasets[0].data=a}});let r=0,l=0,i=0;n.forEach((e,o)=>{n[o].monthlyGrowth=!1;const r=o-1;if(r in n){const t=n[r],a=e.members-t.members;n[r].monthlyGrowth=a,i<=6&&(l+=a,i++)}if("month"==t){const t={t:e.date,y:e.members};a.push(t),lineChartData.datasets[0].data=a}});const d=e[e.length-1][1];r=l/i,document.getElementById("averageMonthlyGrowth").innerHTML=Math.round(r)+" members",document.getElementById("averageMonthlyGrowthValue").innerHTML=`(+${(r/d*100).toFixed(2)}%)`;let u=0,c=0,s=0;for(let t=e.length-1;t>e.length-7;t--){let n=e[t-1];if(n){c+=e[t][1]-n[1],s++}}function h(){let t=0,e=0;return n.forEach((n,a)=>{const o=n.monthlyGrowth;o&&o>e&&(e=n.monthlyGrowth,t=a)}),n[t]}u=c/s,document.getElementById("averageDailyGrowth").innerHTML=Math.round(u)+" members",document.getElementById("averageDailyGrowthValue").innerHTML=`(+${(u/d*100).toFixed(2)}%)`,document.getElementById("highestGrowthMonth").innerHTML=h().date.toLocaleString("default",{month:"short",year:"numeric"}),document.getElementById("highestGrowthValue").innerHTML=`(+${h().monthlyGrowth})`,lineChart.update()}async function updateData(){fetch("https://mys-growth.yan3321.com/api/").then(t=>t.ok?t.json():Promise.reject("Error occured getting API data")).then(t=>{document.getElementById("textLastUpdated").innerHTML=`Data last updated ${(new Date).toString()}`,updateView(void 0,t),cachedData=t}).catch(t=>console.error(t))}updateData();const updateInterval=3e4;let updateIntervalRunner=!1;autoUpdate&&(updateIntervalRunner=setInterval(updateData,3e4));const toggleViewButton=document.getElementById("viewToggleButton");function updateToggleViewButtonState(){"full"==currentMode?(updateView(currentMode="month"),toggleViewButton.innerHTML="Full View",toggleViewButton.classList.add("btn-secondary"),toggleViewButton.classList.remove("btn-primary")):(updateView(currentMode="full"),toggleViewButton.innerHTML="Monthly View",toggleViewButton.classList.add("btn-primary"),toggleViewButton.classList.remove("btn-secondary"))}toggleViewButton.addEventListener("click",updateToggleViewButtonState);